<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deployment Guide - Alive5 Voice Agent</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding: 40px 0;
        }

        .header h1 {
            font-size: 3.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.3rem;
            opacity: 0.9;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 2rem;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .card h3 {
            color: #764ba2;
            margin: 20px 0 10px 0;
            font-size: 1.4rem;
        }

        .step {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #667eea;
        }

        .step h4 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
        }

        .code-block .comment {
            color: #68d391;
        }

        .code-block .string {
            color: #fbb6ce;
        }

        .code-block .keyword {
            color: #90cdf4;
        }

        .table-container {
            overflow-x: auto;
            margin: 20px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background: #f8f9ff;
        }

        .badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin: 2px;
        }

        .badge.success {
            background: #48bb78;
        }

        .badge.warning {
            background: #ed8936;
        }

        .badge.error {
            background: #f56565;
        }

        .badge.info {
            background: #4299e1;
        }

        .highlight {
            background: linear-gradient(120deg, #a8edea 0%, #fed6e3 100%);
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
        }

        .toc {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .toc h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .toc ul {
            list-style: none;
        }

        .toc li {
            margin: 8px 0;
        }

        .toc a {
            color: #667eea;
            text-decoration: none;
            padding: 5px 10px;
            border-radius: 5px;
            transition: background 0.3s ease;
        }

        .toc a:hover {
            background: #e2e8f0;
        }

        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.5rem;
            }
            
            .card {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Deployment Guide</h1>
            <p>Alive5 Voice Agent - Production Deployment Instructions</p>
        </div>

        <!-- Table of Contents -->
        <div class="card">
            <div class="toc">
                <h3>üìã Table of Contents</h3>
                <ul>
                    <li><a href="#overview">Overview</a></li>
                    <li><a href="#prerequisites">Prerequisites</a></li>
                    <li><a href="#repository-setup">Repository Setup</a></li>
                    <li><a href="#frontend-deployment">Frontend Deployment (Vercel)</a></li>
                    <li><a href="#backend-deployment">Backend Deployment (Render)</a></li>
                    <li><a href="#worker-deployment">Worker Deployment (Render)</a></li>
                    <li><a href="#update-configuration">Update Configuration</a></li>
                    <li><a href="#testing">Testing</a></li>
                    <li><a href="#monitoring">Monitoring Setup</a></li>
                    <li><a href="#production-optimization">Production Optimization</a></li>
                    <li><a href="#troubleshooting">Troubleshooting</a></li>
                    <li><a href="#cost-optimization">Cost Optimization</a></li>
                    <li><a href="#maintenance">Maintenance</a></li>
                </ul>
            </div>
        </div>

        <!-- Overview -->
        <div class="card" id="overview">
            <h2>üåü Overview</h2>
            <p>This guide provides step-by-step instructions for deploying the Alive5 Voice Agent system to production. The system consists of three main components:</p>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Component</th>
                            <th>Platform</th>
                            <th>Purpose</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Frontend</strong></td>
                            <td><span class="badge info">Vercel</span></td>
                            <td>Voice interface and real-time communication</td>
                        </tr>
                        <tr>
                            <td><strong>Backend API</strong></td>
                            <td><span class="badge info">Render</span></td>
                            <td>Flow logic and intent detection</td>
                        </tr>
                        <tr>
                            <td><strong>Worker</strong></td>
                            <td><span class="badge info">Render</span></td>
                            <td>Voice processing and LiveKit integration</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Prerequisites -->
        <div class="card" id="prerequisites">
            <h2>üìã Prerequisites</h2>
            
            <h3>Required Accounts</h3>
            <ul>
                <li><a href="https://vercel.com" target="_blank">Vercel</a> account (free tier)</li>
                <li><a href="https://render.com" target="_blank">Render</a> account (free tier)</li>
                <li><a href="https://github.com" target="_blank">GitHub</a> account</li>
                <li><a href="https://livekit.io" target="_blank">LiveKit</a> account</li>
                <li><a href="https://openai.com" target="_blank">OpenAI</a> account</li>
                <li><a href="https://alive5.com" target="_blank">Alive5</a> account</li>
            </ul>

            <h3>Required Credentials</h3>
            <ul>
                <li>LiveKit API Key and Secret</li>
                <li>OpenAI API Key</li>
                <li>Alive5 API Key and Base URL</li>
                <li>GitHub repository access</li>
            </ul>
        </div>

        <!-- Repository Setup -->
        <div class="card" id="repository-setup">
            <h2>üîß Repository Setup</h2>

            <div class="step">
                <h4>1.1 Fork/Clone Repository</h4>
                <div class="code-block">
git clone https://github.com/your-username/voice-agent-livekit-affan.git
cd voice-agent-livekit-affan
                </div>
            </div>

            <div class="step">
                <h4>1.2 Environment Configuration</h4>
                <p>Create a <code>.env</code> file with your production credentials:</p>
                <div class="code-block">
<span class="comment"># LiveKit Configuration</span>
LIVEKIT_URL=wss://your-livekit-url.livekit.cloud
LIVEKIT_API_KEY=your-livekit-api-key
LIVEKIT_API_SECRET=your-livekit-api-secret

<span class="comment"># OpenAI Configuration</span>
OPENAI_API_KEY=your-openai-api-key

<span class="comment"># Alive5 Configuration</span>
A5_BASE_URL=https://api-v2-stage.alive5.com
A5_API_KEY=your-a5-api-key
A5_FAQ_BOT_ID=your-faq-bot-id

<span class="comment"># Application URLs (will be updated after deployment)</span>
FRONTEND_URL=https://your-frontend-url.vercel.app
BACKEND_URL=https://your-backend-url.onrender.com
                </div>
            </div>
        </div>

        <!-- Frontend Deployment -->
        <div class="card" id="frontend-deployment">
            <h2>üåê Frontend Deployment (Vercel)</h2>

            <div class="step">
                <h4>2.1 Connect to Vercel</h4>
                <ol>
                    <li>Go to <a href="https://vercel.com/dashboard" target="_blank">Vercel Dashboard</a></li>
                    <li>Click "New Project"</li>
                    <li>Import your GitHub repository</li>
                    <li>Select the <code>frontend</code> folder as the root directory</li>
                </ol>
            </div>

            <div class="step">
                <h4>2.2 Configure Build Settings</h4>
                <ul>
                    <li><strong>Framework Preset:</strong> Other</li>
                    <li><strong>Build Command:</strong> (leave empty)</li>
                    <li><strong>Output Directory:</strong> (leave empty)</li>
                    <li><strong>Install Command:</strong> (leave empty)</li>
                </ul>
            </div>

            <div class="step">
                <h4>2.3 Environment Variables</h4>
                <p>Add these environment variables in Vercel:</p>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Variable</th>
                                <th>Value</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>API_BASE_URL</code></td>
                                <td><code>https://your-backend-url.onrender.com</code></td>
                                <td>Backend API URL</td>
                            </tr>
                            <tr>
                                <td><code>BACKEND_URL</code></td>
                                <td><code>https://your-backend-url.onrender.com</code></td>
                                <td>Backend API URL</td>
                            </tr>
                            <tr>
                                <td><code>FRONTEND_URL</code></td>
                                <td><code>https://your-frontend-url.vercel.app</code></td>
                                <td>Frontend URL</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="step">
                <h4>2.4 Deploy</h4>
                <ol>
                    <li>Click "Deploy"</li>
                    <li>Wait for deployment to complete</li>
                    <li>Note the deployment URL (e.g., <code>https://voice-agent-frontend.vercel.app</code>)</li>
                </ol>
            </div>
        </div>

        <!-- Backend Deployment -->
        <div class="card" id="backend-deployment">
            <h2>üîß Backend Deployment (Render)</h2>

            <div class="step">
                <h4>3.1 Create Web Service</h4>
                <ol>
                    <li>Go to <a href="https://dashboard.render.com" target="_blank">Render Dashboard</a></li>
                    <li>Click "New +" ‚Üí "Web Service"</li>
                    <li>Connect your GitHub repository</li>
                </ol>
            </div>

            <div class="step">
                <h4>3.2 Configure Service</h4>
                <ul>
                    <li><strong>Name:</strong> <code>voice-agent-backend</code></li>
                    <li><strong>Environment:</strong> Python 3</li>
                    <li><strong>Region:</strong> Choose closest to your users</li>
                    <li><strong>Branch:</strong> <code>main</code> (or your default branch)</li>
                    <li><strong>Root Directory:</strong> (leave empty)</li>
                    <li><strong>Build Command:</strong> <code>pip install -r requirements.txt</code></li>
                    <li><strong>Start Command:</strong> <code>uvicorn backend.main_dynamic:app --host=0.0.0.0 --port=$PORT</code></li>
                </ul>
            </div>

            <div class="step">
                <h4>3.3 Environment Variables</h4>
                <p>Add these environment variables in Render:</p>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Variable</th>
                                <th>Value</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>LIVEKIT_URL</code></td>
                                <td><code>wss://your-livekit-url.livekit.cloud</code></td>
                                <td>LiveKit WebSocket URL</td>
                            </tr>
                            <tr>
                                <td><code>LIVEKIT_API_KEY</code></td>
                                <td><code>your-livekit-api-key</code></td>
                                <td>LiveKit API Key</td>
                            </tr>
                            <tr>
                                <td><code>LIVEKIT_API_SECRET</code></td>
                                <td><code>your-livekit-api-secret</code></td>
                                <td>LiveKit API Secret</td>
                            </tr>
                            <tr>
                                <td><code>OPENAI_API_KEY</code></td>
                                <td><code>your-openai-api-key</code></td>
                                <td>OpenAI API Key</td>
                            </tr>
                            <tr>
                                <td><code>A5_BASE_URL</code></td>
                                <td><code>https://api-v2-stage.alive5.com</code></td>
                                <td>Alive5 API Base URL</td>
                            </tr>
                            <tr>
                                <td><code>A5_API_KEY</code></td>
                                <td><code>your-a5-api-key</code></td>
                                <td>Alive5 API Key</td>
                            </tr>
                            <tr>
                                <td><code>A5_FAQ_BOT_ID</code></td>
                                <td><code>your-faq-bot-id</code></td>
                                <td>Alive5 FAQ Bot ID</td>
                            </tr>
                            <tr>
                                <td><code>FRONTEND_URL</code></td>
                                <td><code>https://your-frontend-url.vercel.app</code></td>
                                <td>Frontend URL</td>
                            </tr>
                            <tr>
                                <td><code>BACKEND_URL</code></td>
                                <td><code>https://your-backend-url.onrender.com</code></td>
                                <td>Backend URL</td>
                            </tr>
                            <tr>
                                <td><code>PYTHON_VERSION</code></td>
                                <td><code>3.11.0</code></td>
                                <td>Python Version</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="step">
                <h4>3.4 Deploy</h4>
                <ol>
                    <li>Click "Create Web Service"</li>
                    <li>Wait for deployment to complete</li>
                    <li>Note the service URL (e.g., <code>https://voice-agent-backend.onrender.com</code>)</li>
                </ol>
            </div>
        </div>

        <!-- Worker Deployment -->
        <div class="card" id="worker-deployment">
            <h2>‚ö° Worker Deployment (Render)</h2>

            <div class="step">
                <h4>4.1 Create Background Worker</h4>
                <ol>
                    <li>Go to <a href="https://dashboard.render.com" target="_blank">Render Dashboard</a></li>
                    <li>Click "New +" ‚Üí "Background Worker"</li>
                    <li>Connect your GitHub repository</li>
                </ol>
            </div>

            <div class="step">
                <h4>4.2 Configure Worker</h4>
                <ul>
                    <li><strong>Name:</strong> <code>voice-agent-worker</code></li>
                    <li><strong>Environment:</strong> Python 3</li>
                    <li><strong>Region:</strong> Same as backend</li>
                    <li><strong>Branch:</strong> <code>main</code> (or your default branch)</li>
                    <li><strong>Root Directory:</strong> (leave empty)</li>
                    <li><strong>Build Command:</strong> <code>pip install -r requirements.txt</code></li>
                    <li><strong>Start Command:</strong> <code>python backend/worker/main_flow_based.py</code></li>
                </ul>
            </div>

            <div class="step">
                <h4>4.3 Environment Variables</h4>
                <p>Add the same environment variables as the backend (see section 3.3).</p>
            </div>

            <div class="step">
                <h4>4.4 Deploy</h4>
                <ol>
                    <li>Click "Create Background Worker"</li>
                    <li>Wait for deployment to complete</li>
                </ol>
            </div>
        </div>

        <!-- Update Configuration -->
        <div class="card" id="update-configuration">
            <h2>üîß Update Configuration</h2>

            <div class="step">
                <h4>5.1 Update Frontend Environment Variables</h4>
                <ol>
                    <li>Go back to Vercel Dashboard</li>
                    <li>Navigate to your project settings</li>
                    <li>Update environment variables with actual URLs:
                        <ul>
                            <li><code>API_BASE_URL</code>: <code>https://your-backend-url.onrender.com</code></li>
                            <li><code>BACKEND_URL</code>: <code>https://your-backend-url.onrender.com</code></li>
                            <li><code>FRONTEND_URL</code>: <code>https://your-frontend-url.vercel.app</code></li>
                        </ul>
                    </li>
                </ol>
            </div>

            <div class="step">
                <h4>5.2 Redeploy Frontend</h4>
                <ol>
                    <li>Trigger a new deployment in Vercel</li>
                    <li>Wait for deployment to complete</li>
                </ol>
            </div>
        </div>

        <!-- Testing -->
        <div class="card" id="testing">
            <h2>üß™ Testing</h2>

            <div class="step">
                <h4>6.1 Health Check</h4>
                <p>Test the backend API:</p>
                <div class="code-block">
curl https://your-backend-url.onrender.com/health
                </div>
                <p>Expected response:</p>
                <div class="code-block">
{
  <span class="string">"status"</span>: <span class="string">"ok"</span>,
  <span class="string">"active_sessions"</span>: <span class="number">0</span>,
  <span class="string">"timestamp"</span>: <span class="number">1640995200.123</span>
}
                </div>
            </div>

            <div class="step">
                <h4>6.2 Frontend Test</h4>
                <ol>
                    <li>Open your frontend URL in a browser</li>
                    <li>Allow microphone permissions</li>
                    <li>Test voice interaction</li>
                </ol>
            </div>

            <div class="step">
                <h4>6.3 End-to-End Test</h4>
                <ol>
                    <li>Say "Hello" - should get greeting response</li>
                    <li>Say "I need pricing information" - should start pricing flow</li>
                    <li>Say "Can I speak with someone over the phone?" - should initiate transfer</li>
                </ol>
            </div>
        </div>

        <!-- Monitoring Setup -->
        <div class="card" id="monitoring">
            <h2>üìä Monitoring Setup</h2>

            <div class="step">
                <h4>7.1 Render Monitoring</h4>
                <ul>
                    <li>Monitor service health in Render dashboard</li>
                    <li>Set up alerts for service failures</li>
                    <li>Monitor resource usage</li>
                </ul>
            </div>

            <div class="step">
                <h4>7.2 Vercel Monitoring</h4>
                <ul>
                    <li>Monitor deployment status</li>
                    <li>Check function execution logs</li>
                    <li>Monitor performance metrics</li>
                </ul>
            </div>

            <div class="step">
                <h4>7.3 Application Monitoring</h4>
                <ul>
                    <li>Check backend logs for errors</li>
                    <li>Monitor worker logs for voice processing issues</li>
                    <li>Track session success rates</li>
                </ul>
            </div>
        </div>

        <!-- Production Optimization -->
        <div class="card" id="production-optimization">
            <h2>‚ö° Production Optimization</h2>

            <div class="step">
                <h4>8.1 Performance Optimization</h4>
                <ul>
                    <li>Enable Vercel's CDN for static assets</li>
                    <li>Configure Render's auto-scaling</li>
                    <li>Optimize API response times</li>
                </ul>
            </div>

            <div class="step">
                <h4>8.2 Security Hardening</h4>
                <ul>
                    <li>Enable HTTPS (automatic with Vercel/Render)</li>
                    <li>Configure CORS properly</li>
                    <li>Set up rate limiting</li>
                    <li>Monitor for security issues</li>
                </ul>
            </div>

            <div class="step">
                <h4>8.3 Backup Strategy</h4>
                <ul>
                    <li>Regular database backups (if using persistent storage)</li>
                    <li>Code repository backups</li>
                    <li>Environment variable backups</li>
                </ul>
            </div>
        </div>

        <!-- Troubleshooting -->
        <div class="card" id="troubleshooting">
            <h2>üîß Troubleshooting</h2>

            <h3>Common Issues</h3>

            <div class="step">
                <h4>1. Backend Not Starting</h4>
                <p><strong>Symptoms:</strong> 502 Bad Gateway errors</p>
                <p><strong>Solutions:</strong></p>
                <ul>
                    <li>Check environment variables</li>
                    <li>Verify Python version compatibility</li>
                    <li>Check build logs for errors</li>
                </ul>
            </div>

            <div class="step">
                <h4>2. Worker Not Connecting</h4>
                <p><strong>Symptoms:</strong> No voice responses</p>
                <p><strong>Solutions:</strong></p>
                <ul>
                    <li>Verify LiveKit credentials</li>
                    <li>Check worker logs</li>
                    <li>Ensure backend URL is correct</li>
                </ul>
            </div>

            <div class="step">
                <h4>3. Frontend Not Loading</h4>
                <p><strong>Symptoms:</strong> Blank page or errors</p>
                <p><strong>Solutions:</strong></p>
                <ul>
                    <li>Check environment variables</li>
                    <li>Verify build process</li>
                    <li>Check browser console for errors</li>
                </ul>
            </div>

            <div class="step">
                <h4>4. Intent Detection Not Working</h4>
                <p><strong>Symptoms:</strong> Generic responses only</p>
                <p><strong>Solutions:</strong></p>
                <ul>
                    <li>Verify OpenAI API key</li>
                    <li>Check bot template loading</li>
                    <li>Review intent detection logs</li>
                </ul>
            </div>

            <h3>Debug Commands</h3>

            <div class="step">
                <h4>Check Backend Health</h4>
                <div class="code-block">
curl -X GET https://your-backend-url.onrender.com/health
                </div>
            </div>

            <div class="step">
                <h4>Test Intent Detection</h4>
                <div class="code-block">
curl -X POST https://your-backend-url.onrender.com/api/test_intent_detection \
  -H <span class="string">"Content-Type: application/json"</span> \
  -d <span class="string">'{"user_message": "I need pricing information"}'</span>
                </div>
            </div>

            <div class="step">
                <h4>Check Template Info</h4>
                <div class="code-block">
curl -X GET https://your-backend-url.onrender.com/api/template_info
                </div>
            </div>
        </div>

        <!-- Cost Optimization -->
        <div class="card" id="cost-optimization">
            <h2>üí∞ Cost Optimization</h2>

            <h3>Free Tier Limits</h3>
            <ul>
                <li><strong>Vercel:</strong> 100GB bandwidth, 100 serverless function executions</li>
                <li><strong>Render:</strong> 750 hours/month for free tier services</li>
            </ul>

            <h3>Optimization Tips</h3>
            <ul>
                <li>Monitor usage regularly</li>
                <li>Optimize API calls</li>
                <li>Use efficient data structures</li>
                <li>Implement caching where appropriate</li>
            </ul>
        </div>

        <!-- Maintenance -->
        <div class="card" id="maintenance">
            <h2>üîß Maintenance</h2>

            <h3>Regular Tasks</h3>
            <ul>
                <li>Monitor service health</li>
                <li>Update dependencies</li>
                <li>Review logs for issues</li>
                <li>Test functionality regularly</li>
            </ul>

            <h3>Updates</h3>
            <ul>
                <li>Deploy updates through Git</li>
                <li>Test in staging environment first</li>
                <li>Monitor deployment closely</li>
                <li>Rollback if issues occur</li>
            </ul>
        </div>

        <!-- Footer -->
        <div class="card" style="text-align: center; background: linear-gradient(135deg, #667eea, #764ba2); color: white;">
            <h2 style="color: white; border-bottom: 3px solid white;">Support</h2>
            <p style="font-size: 1.2rem; margin: 20px 0;">
                For deployment issues or questions:
            </p>
            <ol style="text-align: left; display: inline-block; margin: 20px 0;">
                <li>Check the troubleshooting section</li>
                <li>Review service logs</li>
                <li>Contact the development team</li>
                <li>Check service status pages</li>
            </ol>
            <div style="margin-top: 30px;">
                <span class="badge" style="background: white; color: #667eea; font-size: 1.1rem; padding: 10px 20px;">
                    üöÄ Deployment Complete
                </span>
            </div>
        </div>
    </div>
</body>
</html>
