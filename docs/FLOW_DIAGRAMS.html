<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flow Diagrams - Alive5 Voice Agent</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding: 40px 0;
        }

        .header h1 {
            font-size: 3.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.3rem;
            opacity: 0.9;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 2rem;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .card h3 {
            color: #764ba2;
            margin: 20px 0 10px 0;
            font-size: 1.4rem;
        }

        .diagram {
            background: #f8f9ff;
            padding: 30px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            overflow-x: auto;
        }

        .mermaid {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .flow-diagram {
            background: #f0f8ff;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border: 2px solid #667eea;
        }

        .flow-step {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            position: relative;
        }

        .flow-step::before {
            content: "‚Üí";
            position: absolute;
            left: -15px;
            top: 50%;
            transform: translateY(-50%);
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .flow-step:first-child::before {
            content: "üéØ";
        }

        .flow-step:last-child::before {
            content: "‚úÖ";
        }

        .sequence-diagram {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #667eea;
        }

        .sequence-step {
            background: white;
            padding: 10px 15px;
            margin: 8px 0;
            border-radius: 5px;
            border-left: 3px solid #667eea;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .state-diagram {
            background: #f0f8ff;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #667eea;
        }

        .state {
            background: white;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 20px;
            border: 2px solid #667eea;
            display: inline-block;
            font-weight: bold;
            color: #667eea;
        }

        .state.active {
            background: #667eea;
            color: white;
        }

        .state.transition {
            background: #f6ad55;
            color: white;
            border-color: #f6ad55;
        }

        .highlight {
            background: linear-gradient(120deg, #a8edea 0%, #fed6e3 100%);
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
        }

        .badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin: 2px;
        }

        .badge.success {
            background: #48bb78;
        }

        .badge.warning {
            background: #ed8936;
        }

        .badge.info {
            background: #4299e1;
        }

        .badge.error {
            background: #f56565;
        }

        .toc {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .toc h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .toc ul {
            list-style: none;
        }

        .toc li {
            margin: 8px 0;
        }

        .toc a {
            color: #667eea;
            text-decoration: none;
            padding: 5px 10px;
            border-radius: 5px;
            transition: background 0.3s ease;
        }

        .toc a:hover {
            background: #e2e8f0;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.5rem;
            }
            
            .card {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîÑ Flow Diagrams</h1>
            <p>Alive5 Voice Agent - Visual System Architecture</p>
        </div>

        <!-- Table of Contents -->
        <div class="card">
            <div class="toc">
                <h3>üìã Table of Contents</h3>
                <ul>
                    <li><a href="#system-architecture">System Architecture Flow</a></li>
                    <li><a href="#intent-detection">Intent Detection Flow</a></li>
                    <li><a href="#conversation-flows">Conversation Flow Examples</a></li>
                    <li><a href="#state-management">State Management Flow</a></li>
                    <li><a href="#error-handling">Error Handling Flow</a></li>
                    <li><a href="#deployment">Deployment Flow</a></li>
                    <li><a href="#data-flow">Data Flow Architecture</a></li>
                    <li><a href="#performance">Performance Monitoring Flow</a></li>
                    <li><a href="#security">Security Flow</a></li>
                    <li><a href="#session-lifecycle">Session Lifecycle</a></li>
                </ul>
            </div>
        </div>

        <!-- System Architecture Flow -->
        <div class="card" id="system-architecture">
            <h2>üèóÔ∏è System Architecture Flow</h2>
            <div class="diagram">
                <div class="mermaid">
graph TB
    A[User Voice Input] --> B[Frontend - LiveKit]
    B --> C[Worker - Voice Processing]
    C --> D[Backend API - Flow Logic]
    D --> E{Intent Detection}
    E -->|Escalation| F[Agent Transfer]
    E -->|LLM Analysis| G[Flow Processing]
    G --> H[Response Generation]
    H --> I[Worker - Voice Output]
    I --> J[Frontend - Audio Playback]
    F --> K[Human Agent]
    
    style A fill:#e1f5fe
    style K fill:#f3e5f5
    style E fill:#fff3e0
    style G fill:#e8f5e8
                </div>
            </div>
            
            <div class="flow-diagram">
                <h3>Data Flow</h3>
                <div class="flow-step">
                    <strong>User Voice Input</strong><br>
                    User speaks into microphone
                </div>
                <div class="flow-step">
                    <strong>Frontend Processing</strong><br>
                    LiveKit client captures and processes audio
                </div>
                <div class="flow-step">
                    <strong>Worker Processing</strong><br>
                    Voice processing and conversation management
                </div>
                <div class="flow-step">
                    <strong>Backend API</strong><br>
                    Flow logic and intent detection
                </div>
                <div class="flow-step">
                    <strong>Response Generation</strong><br>
                    AI-powered response creation
                </div>
                <div class="flow-step">
                    <strong>Voice Output</strong><br>
                    Audio response delivered to user
                </div>
            </div>
        </div>

        <!-- Intent Detection Flow -->
        <div class="card" id="intent-detection">
            <h2>üéØ Intent Detection Flow</h2>
            <div class="diagram">
                <div class="mermaid">
graph TD
    A[User Message] --> B{Pattern Match Check}
    B -->|Agent Keywords| C[Transfer Initiated]
    B -->|No Match| D[LLM Intent Detection]
    D --> E{Intent Found?}
    E -->|Yes| F[Flow Processing]
    E -->|No| G[FAQ Bot Fallback]
    F --> H[Response Generation]
    G --> H
    C --> I[Human Agent Connection]
    
    style A fill:#e1f5fe
    style C fill:#ffebee
    style F fill:#e8f5e8
    style G fill:#fff3e0
    style I fill:#f3e5f5
                </div>
            </div>
            
            <div class="flow-diagram">
                <h3>Detection Process</h3>
                <div class="flow-step">
                    <strong>User Input</strong><br>
                    "Can I speak with someone over the phone?"
                </div>
                <div class="flow-step">
                    <strong>Escalation Check</strong><br>
                    Pattern matching for agent requests (instant response)
                </div>
                <div class="flow-step">
                    <strong>LLM Intent Detection</strong><br>
                    AI-powered analysis for complex intents
                </div>
                <div class="flow-step">
                    <strong>Flow Processing</strong><br>
                    Dynamic conversation flow execution
                </div>
            </div>
        </div>

        <!-- Conversation Flow Examples -->
        <div class="card" id="conversation-flows">
            <h2>üí¨ Conversation Flow Examples</h2>

            <h3>1. Agent Transfer Flow</h3>
            <div class="diagram">
                <div class="mermaid">
sequenceDiagram
    participant U as User
    participant F as Frontend
    participant W as Worker
    participant B as Backend
    participant A as Agent
    
    U->>F: "Can I speak with someone?"
    F->>W: Voice Data
    W->>B: Process Message
    B->>B: Escalation Detection
    B->>W: Transfer Initiated
    W->>F: "Connecting to agent..."
    F->>U: Audio Response
    B->>A: Transfer Request
    A->>U: Human Agent Connected
                </div>
            </div>

            <h3>2. Pricing Flow</h3>
            <div class="diagram">
                <div class="mermaid">
sequenceDiagram
    participant U as User
    participant F as Frontend
    participant W as Worker
    participant B as Backend
    
    U->>F: "I need pricing"
    F->>W: Voice Data
    W->>B: Process Message
    B->>B: LLM Intent Detection
    B->>W: Flow Started (Pricing)
    W->>F: "How many phone lines?"
    F->>U: Audio Response
    
    U->>F: "5 lines"
    F->>W: Voice Data
    W->>B: Process Response
    B->>W: Next Question
    W->>F: "How many texts per month?"
    F->>U: Audio Response
    
    U->>F: "2000 texts"
    F->>W: Voice Data
    W->>B: Process Response
    B->>W: Final Question
    W->>F: "Any special needs?"
    F->>U: Audio Response
    
    U->>F: "Salesforce integration"
    F->>W: Voice Data
    W->>B: Process Response
    B->>W: Flow Complete
    W->>F: "Generating plan..."
    F->>U: Audio Response
                </div>
            </div>

            <h3>3. Weather Flow</h3>
            <div class="diagram">
                <div class="mermaid">
sequenceDiagram
    participant U as User
    participant F as Frontend
    participant W as Worker
    participant B as Backend
    participant API as Weather API
    
    U->>F: "What's the weather?"
    F->>W: Voice Data
    W->>B: Process Message
    B->>B: LLM Intent Detection
    B->>W: Flow Started (Weather)
    W->>F: "What's your zip code?"
    F->>U: Audio Response
    
    U->>F: "90210"
    F->>W: Voice Data
    W->>B: Process Response
    B->>API: Get Weather Data
    API->>B: Weather Information
    B->>W: Weather Response
    W->>F: "Current weather in Beverly Hills..."
    F->>U: Audio Response
                </div>
            </div>
        </div>

        <!-- State Management Flow -->
        <div class="card" id="state-management">
            <h2>üîÑ State Management Flow</h2>
            <div class="diagram">
                <div class="mermaid">
stateDiagram-v2
    [*] --> NewSession
    NewSession --> IntentDetection
    IntentDetection --> GreetingFlow : Greeting Intent
    IntentDetection --> PricingFlow : Pricing Intent
    IntentDetection --> WeatherFlow : Weather Intent
    IntentDetection --> AgentTransfer : Agent Intent
    IntentDetection --> FAQFallback : No Intent
    
    GreetingFlow --> ConversationActive
    PricingFlow --> ConversationActive
    WeatherFlow --> ConversationActive
    FAQFallback --> ConversationActive
    
    ConversationActive --> FlowProcessing
    FlowProcessing --> ConversationActive : Continue Flow
    FlowProcessing --> FlowComplete : Flow Finished
    FlowProcessing --> AgentTransfer : Escalation
    
    AgentTransfer --> HumanAgent
    FlowComplete --> SessionEnd
    HumanAgent --> SessionEnd
    SessionEnd --> [*]
    
    note right of AgentTransfer
        Immediate response:
        "Connecting to agent..."
    end note
                </div>
            </div>
            
            <div class="flow-diagram">
                <h3>State Transitions</h3>
                <div class="flow-step">
                    <strong>New Session</strong><br>
                    User connects and session is initialized
                </div>
                <div class="flow-step">
                    <strong>Intent Detection</strong><br>
                    System analyzes user input to determine intent
                </div>
                <div class="flow-step">
                    <strong>Flow Processing</strong><br>
                    Appropriate conversation flow is executed
                </div>
                <div class="flow-step">
                    <strong>Conversation Active</strong><br>
                    Ongoing dialogue with user
                </div>
                <div class="flow-step">
                    <strong>Session End</strong><br>
                    Conversation completed and resources cleaned up
                </div>
            </div>
        </div>

        <!-- Error Handling Flow -->
        <div class="card" id="error-handling">
            <h2>‚ö†Ô∏è Error Handling Flow</h2>
            <div class="diagram">
                <div class="mermaid">
graph TD
    A[Request Received] --> B{Valid Request?}
    B -->|No| C[400 Bad Request]
    B -->|Yes| D[Process Request]
    D --> E{Processing Success?}
    E -->|No| F{Error Type}
    F -->|Network| G[Retry Logic]
    F -->|Validation| H[400 Bad Request]
    F -->|Server| I[500 Internal Error]
    E -->|Yes| J[Success Response]
    G --> K{Retry Success?}
    K -->|Yes| J
    K -->|No| I
    
    style C fill:#ffebee
    style H fill:#ffebee
    style I fill:#ffebee
    style J fill:#e8f5e8
                </div>
            </div>
            
            <div class="flow-diagram">
                <h3>Error Types</h3>
                <div class="flow-step">
                    <strong>400 Bad Request</strong><br>
                    Invalid request data or missing parameters
                </div>
                <div class="flow-step">
                    <strong>500 Internal Server Error</strong><br>
                    Server-side processing errors
                </div>
                <div class="flow-step">
                    <strong>Network Errors</strong><br>
                    Connection issues with external services
                </div>
                <div class="flow-step">
                    <strong>Retry Logic</strong><br>
                    Automatic retry for transient failures
                </div>
            </div>
        </div>

        <!-- Deployment Flow -->
        <div class="card" id="deployment">
            <h2>üöÄ Deployment Flow</h2>
            <div class="diagram">
                <div class="mermaid">
graph LR
    A[Code Repository] --> B[GitHub]
    B --> C[Vercel - Frontend]
    B --> D[Render - Backend]
    B --> E[Render - Background Worker]
    
    C --> F[Frontend Deployed]
    D --> G[Backend Deployed]
    E --> H[Worker Deployed]
    
    F --> I[Production System]
    G --> I
    H --> I
    
    style A fill:#e1f5fe
    style I fill:#e8f5e8
    style C fill:#fff3e0
    style D fill:#fff3e0
    style E fill:#fff3e0
                </div>
            </div>
            
            <div class="flow-diagram">
                <h3>Deployment Process</h3>
                <div class="flow-step">
                    <strong>Code Repository</strong><br>
                    Source code stored in GitHub
                </div>
                <div class="flow-step">
                    <strong>Frontend Deployment</strong><br>
                    Vercel automatically deploys frontend
                </div>
                <div class="flow-step">
                    <strong>Backend Deployment</strong><br>
                    Render deploys backend API service
                </div>
                <div class="flow-step">
                    <strong>Worker Deployment</strong><br>
                    Render deploys background worker
                </div>
                <div class="flow-step">
                    <strong>Production System</strong><br>
                    All components integrated and running
                </div>
            </div>
        </div>

        <!-- Data Flow Architecture -->
        <div class="card" id="data-flow">
            <h2>üìä Data Flow Architecture</h2>
            <div class="diagram">
                <div class="mermaid">
graph TB
    subgraph "Frontend Layer"
        A[Voice Input] --> B[LiveKit Client]
        B --> C[Real-time Communication]
    end
    
    subgraph "Worker Layer"
        E[Voice Processing] --> F[LiveKit Agent]
        F --> G[Conversation Management]
        G --> H[Backend Communication]
    end
    
    subgraph "Backend Layer"
        I[API Endpoints] --> J[Flow Logic]
        J --> K[Intent Detection]
        K --> L[State Management]
        L --> M[Response Generation]
    end
    
    subgraph "External Services"
        N[OpenAI API] --> K
        O[Alive5 API] --> J
        P[Weather API] --> J
    end
    
    C --> E
    H --> I
    M --> H
    
    style A fill:#e1f5fe
    style N fill:#fff3e0
    style O fill:#fff3e0
    style P fill:#fff3e0
                </div>
            </div>
            
            <div class="flow-diagram">
                <h3>Data Flow Layers</h3>
                <div class="flow-step">
                    <strong>Frontend Layer</strong><br>
                    Voice input, LiveKit client, real-time communication
                </div>
                <div class="flow-step">
                    <strong>Worker Layer</strong><br>
                    Voice processing, LiveKit agent, conversation management
                </div>
                <div class="flow-step">
                    <strong>Backend Layer</strong><br>
                    API endpoints, flow logic, response generation
                </div>
                <div class="flow-step">
                    <strong>External Services</strong><br>
                    OpenAI API, Alive5 API, Weather API
                </div>
            </div>
        </div>

        <!-- Performance Monitoring Flow -->
        <div class="card" id="performance">
            <h2>üìà Performance Monitoring Flow</h2>
            <div class="diagram">
                <div class="mermaid">
graph TD
    A[Request] --> B[Load Balancer]
    B --> C[API Gateway]
    C --> D[Rate Limiting]
    D --> E[Authentication]
    E --> F[Request Processing]
    F --> G[Response Generation]
    G --> H[Logging]
    H --> I[Metrics Collection]
    I --> J[Monitoring Dashboard]
    
    F --> K{Error?}
    K -->|Yes| L[Error Logging]
    K -->|No| M[Success Logging]
    L --> H
    M --> H
    
    style A fill:#e1f5fe
    style J fill:#e8f5e8
    style L fill:#ffebee
    style M fill:#e8f5e8
                </div>
            </div>
            
            <div class="flow-diagram">
                <h3>Monitoring Components</h3>
                <div class="flow-step">
                    <strong>Load Balancer</strong><br>
                    Distributes requests across multiple instances
                </div>
                <div class="flow-step">
                    <strong>API Gateway</strong><br>
                    Central entry point for all API requests
                </div>
                <div class="flow-step">
                    <strong>Rate Limiting</strong><br>
                    Prevents abuse and ensures fair usage
                </div>
                <div class="flow-step">
                    <strong>Authentication</strong><br>
                    Validates user credentials and permissions
                </div>
                <div class="flow-step">
                    <strong>Logging</strong><br>
                    Records all requests and responses
                </div>
                <div class="flow-step">
                    <strong>Metrics Collection</strong><br>
                    Gathers performance and usage statistics
                </div>
                <div class="flow-step">
                    <strong>Monitoring Dashboard</strong><br>
                    Real-time visualization of system health
                </div>
            </div>
        </div>

        <!-- Security Flow -->
        <div class="card" id="security">
            <h2>üîí Security Flow</h2>
            <div class="diagram">
                <div class="mermaid">
graph TD
    A[Incoming Request] --> B[HTTPS Validation]
    B --> C[Rate Limiting]
    C --> D[JWT Validation]
    D --> E{Valid Token?}
    E -->|No| F[401 Unauthorized]
    E -->|Yes| G[Request Processing]
    G --> H[Data Validation]
    H --> I{Valid Data?}
    I -->|No| J[400 Bad Request]
    I -->|Yes| K[Process Request]
    K --> L[Response Generation]
    L --> M[Secure Response]
    
    style A fill:#e1f5fe
    style F fill:#ffebee
    style J fill:#ffebee
    style M fill:#e8f5e8
                </div>
            </div>
            
            <div class="flow-diagram">
                <h3>Security Layers</h3>
                <div class="flow-step">
                    <strong>HTTPS Validation</strong><br>
                    Ensures encrypted communication
                </div>
                <div class="flow-step">
                    <strong>Rate Limiting</strong><br>
                    Prevents abuse and DDoS attacks
                </div>
                <div class="flow-step">
                    <strong>JWT Validation</strong><br>
                    Authenticates user identity
                </div>
                <div class="flow-step">
                    <strong>Data Validation</strong><br>
                    Validates input data integrity
                </div>
                <div class="flow-step">
                    <strong>Secure Response</strong><br>
                    Encrypted response delivery
                </div>
            </div>
        </div>

        <!-- Session Lifecycle -->
        <div class="card" id="session-lifecycle">
            <h2>üîÑ Session Lifecycle</h2>
            <div class="diagram">
                <div class="mermaid">
graph TD
    A[Session Start] --> B[Connection Established]
    B --> C[Initial Greeting]
    C --> D[User Interaction]
    D --> E{Intent Detected?}
    E -->|Yes| F[Flow Processing]
    E -->|No| G[FAQ Response]
    F --> H{Flow Complete?}
    H -->|No| D
    H -->|Yes| I[Session Summary]
    G --> J{Continue?}
    J -->|Yes| D
    J -->|No| I
    I --> K[Session Cleanup]
    K --> L[Session End]
    
    style A fill:#e1f5fe
    style L fill:#f3e5f5
    style F fill:#e8f5e8
    style G fill:#fff3e0
                </div>
            </div>
            
            <div class="flow-diagram">
                <h3>Session Stages</h3>
                <div class="flow-step">
                    <strong>Session Start</strong><br>
                    User connects and session is initialized
                </div>
                <div class="flow-step">
                    <strong>Connection Established</strong><br>
                    LiveKit connection is established
                </div>
                <div class="flow-step">
                    <strong>Initial Greeting</strong><br>
                    System welcomes the user
                </div>
                <div class="flow-step">
                    <strong>User Interaction</strong><br>
                    Ongoing dialogue with the user
                </div>
                <div class="flow-step">
                    <strong>Intent Detection</strong><br>
                    System determines user intent
                </div>
                <div class="flow-step">
                    <strong>Flow Processing</strong><br>
                    Appropriate conversation flow is executed
                </div>
                <div class="flow-step">
                    <strong>Session Summary</strong><br>
                    Conversation summary is generated
                </div>
                <div class="flow-step">
                    <strong>Session Cleanup</strong><br>
                    Resources are cleaned up and session ends
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="card" style="text-align: center; background: linear-gradient(135deg, #667eea, #764ba2); color: white;">
            <h2 style="color: white; border-bottom: 3px solid white;">Visual System Understanding</h2>
            <p style="font-size: 1.2rem; margin: 20px 0;">
                These diagrams provide a comprehensive visual representation of how the Alive5 Voice Agent system works, from high-level architecture to detailed conversation flows.
            </p>
            <div style="margin-top: 30px;">
                <span class="badge" style="background: white; color: #667eea; font-size: 1.1rem; padding: 10px 20px;">
                    üéØ Client Ready
                </span>
                <span class="badge" style="background: white; color: #667eea; font-size: 1.1rem; padding: 10px 20px;">
                    üìä Technical Documentation
                </span>
                <span class="badge" style="background: white; color: #667eea; font-size: 1.1rem; padding: 10px 20px;">
                    üîÑ System Understanding
                </span>
            </div>
        </div>
    </div>

    <script>
        // Initialize Mermaid
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#667eea',
                primaryTextColor: '#333',
                primaryBorderColor: '#764ba2',
                lineColor: '#667eea',
                secondaryColor: '#f8f9ff',
                tertiaryColor: '#e2e8f0'
            }
        });
    </script>
</body>
</html>
